<!DOCTYPE html>
<html lang="zh-tw" style="height:100%">
<head>
	<meta charset="utf-8" name="viewport" comtent="widch=device-widch,initial-scale=1.0" />
	<title>竹北高中209線上點餐系統</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" />
	<script>
        function createXHR()
        {
            try
            {
                var XHR = new XMLHttpRequest();
            }
            catch(e1)
            {
                try
                {
                    var XHR = new ActiveXObject('Msxml2.XMLHTTP');
                }
                catch(e2)
                {
                    try
                    {
                        var XHR = new ActiveXObject('Microsoft.XMLHTTP');
                    }
                    catch(e3)
                    {
                        XHR = false;
                    }
                }
            }
            return XHR;
        }
    </script>
    <script>
        function defaultLg(id){
            if(document.getElementById(id + "_default").style.display == "flex"){
                document.getElementById(id + "_default").style.display = "none";
                document.getElementById(id + "_lg").style.display = "block";
            }else{
                document.getElementById(id + "_default").style.display = "flex";
                document.getElementById(id + "_lg").style.display = "none";
            }
        }
        function paid(id){
            let XHR = createXHR();
            let send = {"id":id,"status":"1"}
            XHR.open("POST","http://localhost:5000/cashier",true)
            XHR.setRequestHeader("Content-Type", "application/json");
            XHR.onreadystatechange = function () {
                if (XHR.readyState === 4) {
                    if (XHR.status === 200) {
                        //顯示訂單編號
                        console.log("paid")
                    } else {
                        // Error handling
                        console.error("Request failed with status: " + XHR.status);
                    }
                }
            };
            XHR.send(JSON.stringify(send));

        }
        function orderDone(id){
            let XHR = createXHR();
            let send = {"id":id,"status":"3"}
            XHR.open("POST","http://localhost:5000/cashier",true)
            XHR.setRequestHeader("Content-Type", "application/json");
            XHR.onreadystatechange = function () {
                if (XHR.readyState === 4) {
                    if (XHR.status === 200) {
                        //顯示訂單編號
                        console.log("done")
                    } else {
                        // Error handling
                        console.error("Request failed with status: " + XHR.status);
                    }
                }
            };
            XHR.send(JSON.stringify(send));
        }
    </script>
    <style>
        .item{
            width:calc(100% - 20px);
            margin-left: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgb(206, 206, 206);
            border-radius: 10px;
        }
        .item_default{
            display: flex;
            flex-wrap: nowrap;
        }
        .order_num{
            
            flex:2;
        }
        .item_list{
            
            flex:2;
        }
        .money{
            flex:1;
        }
        .buttons{
            display: flex;
            flex-wrap: nowrap;
            flex:2;
        }
        item_lg{
            display: none;
        }
        .lg_upper{
            display: flex;
            flex-wrap: nowrap;
        }
        .lg_middle{
            padding: 20px;
        }
        .lg_footer{
            display: flex;
            flex-wrap: nowrap;
        }

        .order_num_lg{
            flex:1;
        }
        .money_lg{
            flex:1;
        }

        .input_wrapper{
            display: flex;
        }
        .input_numbutton_left{
            border: none;
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
        }
        .input_numbutton_right{
            border: none;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
        }
        .input_num{
            width:35px;
        }
        input[type="number"] {
            -webkit-appearance: textfield;
            appearance: textfield;
            margin: 0;
        }
        .history_btn{
            border: none;
            height:80px;
            width:calc(100% - 100px);
            margin-left: 50px;
            border-radius: 10px;
        }
    </style>
    
</head>
<body>
    <strong><p align="center" style="font-size: 100px;">209收銀</p></strong>
    <span id="items">
        <!--
        <div id="example1" class="item" onclick="defaultLg('example1')">
            <div id="example1_default" class="item_default">
                <div class="order_num">
                    <h1>#AR326</h1>
                </div>
                <div class="item_list">
                    <h6>-冰淇淋(一球)</h6>
                    <h6>-炸薯條</h6>
                </div>
                <div class="money">
                    <h1 style="color: red;">$75</h1>
                </div>
            </div>
            <div id="example1_lg">
                <div class="lg_upper">
                    <div class="order_num_lg">
                        <h1>#AR326</h1>
                    </div>
                    <div class="money_lg">
                        <h1 style="color: red;" align="right">$75</h1>
                    </div>
                </div>
                <div class="lg_middle">
                    <h6>-冰淇淋(一球)</h6>
                    <h6>-炸薯條</h6>
                </div>
                <div class="lg_footer">
                    <span id="example1_buttons">

                    </span>
                    <--<button type="button">已付款</button>
                    <button type="button">完成訂單</button>->
                </div>
            </div>
            
        </div>
        -->
    </span>
    <h2><button class="history_btn">歷史訂單</button></h2>
    <script>
        /*
            status:
            0 = 未付款
            1 = 已付款，製作中
            2 = 餐點準備完成
            3 = 訂單已完成(變成歷史訂單)
        */
       /*
        order_list = [
            {
                "id":"example1",
                "item_list":[
                    {"name":"冰淇淋(一球)","qty":1},
                    {"name":"炸薯條","qty":1}
                ],
                "total":75,
                "status":1    
            },
            {
                "id":"example2",
                "item_list":[
                    {"name":"冰淇淋(兩球)","qty":1},
                    {"name":"烤香腸","qty":1}
                ],
                "total":70,
                "status":0 
            }
        ]
        /*----顯示每筆訂單----*/
        /*
        for(let i = 0;i < order_list.length;i++){
            //
            let id = order_list[i]["id"];
            let htmlText = "<div id='"+order_list[i]["id"]+"' class='item' onclick='defaultLg(\""+order_list[i]["id"]+"\")'><div id='"+order_list[i]["id"]+"_default' class='item_default'><div class='id'>";
            htmlText += "<h1>"+order_list[i]["id"]+"</h1>";
            htmlText += "</div><div class='item_list'>";
            for(let j = 0;j < order_list[i]["item_list"].length;j++){
                htmlText += "<h4>-"+order_list[i]["item_list"][j]["name"]+"</h4>";
            }
            htmlText += "</div><div class='money'>";
            htmlText += "<h1 style='color: red;'>$"+order_list[i]["total"]+"</h1>";
            htmlText += "</div></div><div id='"+order_list[i]["id"]+"_lg'><div class='lg_upper'><div class='order_num_lg'>";
            htmlText += "<h1>"+order_list[i]["id"]+"</h1>";
            htmlText += "</div><div class='money_lg'>";
            htmlText += "<h1 style='color: red;'' align='right'>$"+order_list[i]["total"]+"</h1>";
            htmlText += "</div></div><div class='lg_middle'>";
                for(let j = 0;j < order_list[i]["item_list"].length;j++){
                htmlText += "<h4>-"+order_list[i]["item_list"][j]["name"]+"</h4>";
            }
            htmlText += "</div><div class='lg_footer'><span id='"+order_list[i]["id"]+"_buttons'></span></div></div></div>";
            document.getElementById("items").innerHTML = document.getElementById("items").innerHTML + htmlText;
        
            document.getElementById(id + "_default").style.display = "flex";
            document.getElementById(id + "_lg").style.display = "none";
            //分辨訂單種類
            if(order_list[i]["status"] == 0){
                document.getElementById(id + "_buttons").innerHTML = "<button type='button'>確認已付款</button>";
            }else if(order_list[i]["status"] == 2){
                document.getElementById(id + "_buttons").innerHTML = "<button type='button'>完成訂單</button>";
            }
        }*/
        /*-------------------------------------------------------------------------*/
        XHR = createXHR()
        setInterval(()=>{
            XHR.open("GET","http://localhost:5000/cashier_refresh",true)
            XHR.onreadystatechange = function () {
                if (XHR.readyState === 4) {
                    if (XHR.status === 200) {
                        // Successful response
                        var response = XHR.responseText;
                        console.log(response)
                        response = JSON.parse(response)
                        order_list = response;
                        /*
                        order_list = [
                            {
                                "id":"example1",
                                "item_list":[
                                    {"name":"冰淇淋(一球)","flavor":"香草","qty":1},
                                    {"name":"冰淇淋(三球)","flavor":"香草+草莓+巧克力","qty":1},
                                    {"name":"炸薯條","flavor":"","qty":1}
                                ],
                                "total":75,
                                "status":1    
                            },
                            {
                                "id":"example2",
                                "item_list":[
                                    {"name":"冰淇淋(一球)","flavor":"香草","qty":1},
                                    {"name":"冰淇淋(三球)","flavor":"香草+草莓+巧克力","qty":1},
                                    {"name":"炸薯條","flavor":"","qty":1}
                                ],
                                "total":70,
                                "status":0 
                            }
                        ]
                        */
                        /*----顯示每筆訂單----*/
                        for(let i = 0;i < order_list.length;i++){
                            let item_list = []
                            if(order_list[i].hasOwnProperty('1')){
                                item_list.push({"name":"冰淇淋(一球)","flavor":order_list[i]["1"]["flavor"] , "qty":"1"})
                            }
                            if(order_list[i].hasOwnProperty('2')){
                                item_list.push({"name":"冰淇淋(兩球)","flavor":order_list[i]["1"]["flavor"] , "qty":"1"})
                            }
                            if(order_list[i].hasOwnProperty('3')){
                                item_list.push({"name":"冰淇淋(三球)","flavor":order_list[i]["1"]["flavor"] , "qty":"1"})
                            }
                            if(order_list[i].hasOwnProperty('4')){
                                item_list.push({"name":"香腸","flavor":order_list[i]["1"]["flavor"] , "qty":"1"})
                            }
                            if(order_list[i].hasOwnProperty('5')){
                                item_list.push({"name":"薯條","flavor":order_list[i]["1"]["flavor"] , "qty":"1"})
                            }
                            if(order_list[i].hasOwnProperty('6')){
                                item_list.push({"name":"氣泡飲","flavor":order_list[i]["1"]["flavor"] , "qty":"1"})
                            }
                
                            //
                            let id = order_list[i]["id"];
                            let htmlText = "<div id='"+order_list[i]["id"]+"' class='item' onclick='defaultLg(\""+order_list[i]["id"]+"\")'><div id='"+order_list[i]["id"]+"_default' class='item_default'><div class='order_num'>";
                            htmlText += "<h1>"+order_list[i]["id"]+"</h1>";
                            htmlText += "</div><div class='item_list'>";

                            for(let j = 0;j < item_list.length;j++){
                                htmlText += "<h4>-"+item_list[j]["name"]+"</h4>";
                            }

                            htmlText += "</div><div class='money'>";
                            htmlText += "<h1 style='color: red;'>$"+order_list[i]["total"]+"</h1>";
                            htmlText += "</div></div><div id='"+order_list[i]["id"]+"_lg'><div class='lg_upper'><div class='order_num_lg'>";
                            htmlText += "<h1>"+order_list[i]["id"]+"</h1>";
                            htmlText += "</div><div class='money_lg'>";
                            htmlText += "<h1 style='color: red;'' align='right'>$"+order_list[i]["total"]+"</h1>";
                            htmlText += "</div></div><div class='lg_middle'>";

                            for(let j = 0;j < item_list.length;j++){
                                htmlText += "<h4>-"+item_list[j]["name"]+"</h4>";
                            }

                            htmlText += "</div><div class='lg_footer'><span id='"+order_list[i]["id"]+"_buttons'></span></div></div></div>";
                            document.getElementById("items").innerHTML = document.getElementById("items").innerHTML + htmlText;
                        
                            document.getElementById(id + "_default").style.display = "flex";
                            document.getElementById(id + "_lg").style.display = "none";
                            //分辨訂單種類
                            if(order_list[i]["status"] == 0){
                                document.getElementById(id + "_buttons").innerHTML = "<button type='button' onclick=\"paid('"+id+"')\">確認已付款</button>";
                            }else if(order_list[i]["status"] == 2){
                                document.getElementById(id + "_buttons").innerHTML = "<button type='button' onclick=\"orderDone('"+id+"')\">完成訂單</button>";
                            }
                        }
                        // You can parse and work with the response data here
                        console.log(response);
                    } else {
                        // Error handling
                        console.error("Request failed with status: " + xhr.status);
                    }
                }
            };
        XHR.send(null);
            
        },20000)
        </script>
</body>
</html>
